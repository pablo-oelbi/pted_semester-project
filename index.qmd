<<<<<<< HEAD
---
title: Commuting Mode Choice based on distance to the next train station
author: Marijana Maric and Pablo Bischofberger
output: html
---

<!-- You can add  your R Code with Code chunks-->

```{r}
#| echo: false
#| warning: false
#| message: false

# You can set chunk options individually per code chunk, as was done with this
# code chunk.

# echo: false           hides the code from the generated output
# warning: false        hides warnings from the generated output
# message: false        hides messages from the generated output

# To apply the setting for all code chunks, add the options to the yaml header of the document (in between the ---) without the preceeding "#|".

knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(dplyr)
library(lubridate)
library(ggplot2)
library(plotly)
library(tidyr)
library(sf)
library(sp)
library(tmap)
library(tmaptools)
library(geosphere)
library(purrr)
library(cowplot)
library(rnaturalearth)
library(rnaturalearthdata)

```

## **Abstract**

This study examines the relationship between the distance from home to the train station and the transportation mode used. The analysis of trajectory data seeks to identify patterns and factors influencing the choice of transportation. Statistical methods, such as regression models and clustering techniques, are employed. The study is constrained by the small sample size, inaccurate GPS data, and unaccounted for confounding variables.

## Introduction

<!-- the following is just a placeholder text, remove it!-->

Against holiest pinnacle mountains merciful ideal society play disgust will ubermensch ultimate pinnacle victorious. Snare value law gains battle pious intentions revaluation strong. Insofar snare faith ideal oneself.

## **Data Description**

### *Dataset*

The data consist of GPS trajectory data collected from 9 individuals between beginning April 2023 and end of May 2023 which were tracking their movement with the POSMO application. The Posmo Project app automatically records any walking, cycling, transit and car driving you each individual is performing. The starting dataset has the following structure and includes the following Variables:

-   **`user_id`**: A unique identifier for each individual in the study. (chr)

-   **`datetime`**: The date and time of each recorded location. (dttm)

-   **`weekday`**: The day of the week. (chr)

-   **`transport_mode`**: The mode of transportation used by the individual (e.g., walking, biking, car, bus or tram).(chr)

-   **`lon_x`** and **`lat_y`**: The longitude and latitude of each recorded location.(dbl)

```{r data_loading}
# List all CSV files in the directory
file_list <- list.files(path = "data", pattern = "*.csv", full.names = TRUE)

# Read each CSV file into a data frame and concatenate them together
posmo <- do.call(rbind, lapply(file_list, function(x) read.csv(x, stringsAsFactors = FALSE)))

# Convert the datetime column to POSIXct type
posmo$datetime <- as.POSIXct(posmo$datetime, format = "%Y-%m-%dT%H:%M:%S", tz = "GMT")

# Convert user_id to a factor and then to numeric
posmo$user_id <- as.numeric(factor(posmo$user_id))

# Keep only the necessary columns and combine walk and run
posmo <- posmo |> 
  arrange(user_id, datetime) |>  
  select(user_id, datetime,transport_mode, lon_x, lat_y) |>
  mutate(transport_mode = ifelse(transport_mode == 'Run', 'Walk', transport_mode),
         transport_mode = ifelse(transport_mode == 'Funicular', 'Tram', transport_mode))

# Check for NA's and empty strings in the data
any(is.na(posmo))

# check which columns: 
apply(posmo, 2, function(x) any(is.na(x)))

#remove na data
posmo <- na.omit(posmo)

any(sapply(posmo |>select(user_id,transport_mode, lon_x, lat_y), function(x) any(x == "")))

# Create a data frame with non-empty transport_mode
posmo <- posmo|>filter(transport_mode != "")
```

```{r summary_table, warning=FALSE, echo=TRUE, message = FALSE}


library(gt)

# Create a summarized dataframe
summary_df <- posmo %>%
  summarise(
    num_users = n_distinct(user_id),
    num_data_points = n(),
    num_datetimes = n_distinct(datetime),
    min_date = min(datetime, na.rm = TRUE),
    max_date = max(datetime, na.rm = TRUE),
    num_transport_modes = n_distinct(transport_mode),
    avg_longitude = mean(lon_x, na.rm = TRUE),
    max_longitude = max(lon_x, na.rm = TRUE),
    min_longitude = min(lon_x, na.rm = TRUE),
    avg_latitude = mean(lat_y, na.rm = TRUE),
    max_latitude = max(lat_y, na.rm = TRUE),
    min_latitude = min(lat_y, na.rm = TRUE)
  )

# Convert to gt table
summary_table <- gt(summary_df) %>%
  tab_header(
    title = "Summary of Posmo Data"
  ) %>%
  cols_label(
    num_users = "Number of Users",
    num_data_points = "Total number of datapoints",
    num_datetimes = "Number of Datetimes",
    min_date = "Minimal recorded datetime",
    max_date = "Maximum recorded datetime",
    num_transport_modes = "Number of Transport Modes",
    avg_longitude = "Average Longitude",
    max_longitude = "Maximum Longitude",
    min_longitude = "Minimum Longitude",
    avg_latitude = "Average Latitude",
    max_latitude = "Maximum Latitude",
    min_latitude = "Minimum Latitude"
  ) %>%
  fmt_number(
    columns = vars(avg_longitude, max_longitude, min_longitude, avg_latitude, max_latitude, min_latitude),
    decimals = 2
  )


# Print the table
print(summary_table)

```

### Data preparation

The process of data cleansing, a key element in any research project, is optimized using well-defined steps. Initially, data from CSV files are compiled into a combined data frame. Subsequently, the data sets are converted into appropriate datatypes to ensure consistency with the following steps of the analysis. The transport mode column is modified to combine similar types like 'Run' and 'Walk'. This step helps to increase the intensity of subsequent analyses. This is followed by a rigorous data cleaning process to detect and delete any instances of NA values or empty strings, ensuring data integrity and completeness.

Once the initial data cleaning is completed, the data cycle is further enhanced with analytical metrics. A unique identifier 'trip_id' is calculated for each particular trip, a it provides a systematic way of classifying and analyzing data. Subsequently, the data are grouped according to each trip, and then two measures of distance (in meters) and elapsed time (in minutes) are calculated for each trip. Lastly, the data set is filtered to store only trips that occur immediately before or after a train trip. This strategic selection of data lays the foundation for answering the research questions, focusing on the patterns associated with the mode of transportation before starting a train trip.

In the end we have the following data structure:

-   **`trip_id`**: A unique identifier assigned to each individual journey made by a participant in the study. This identifier is used to differentiate between different trips made by the same user. (int)

-   **`user_id`**: A unique identifier for each participant in the study. This identifier is used to differentiate between the data of different participants. (num)

-   **`day`**: The date on which the recorded location data was collected. (Date)

-   **`transport_mode`**: The mode of transportation used by the participant at a given recorded location. This could include various modes such as walking, using a bike, car, bus, tram, or other. (chr)

-   **`last_transport_mode`**: The mode of transportation that was used by the participant directly before the current `transport_mode`. This provides a sense of sequence in the participant's mode of transportation. (chr)

-   **`next_transport_mode`**: The mode of transportation that was used by the participant directly after the current `transport_mode`. This, along with `last_transport_mode`, provides a context to the sequence of transportation modes used by the participant. (chr)

-   **`distance`**: The total distance covered by the participant during a particular trip. This measurement is derived from the collected location data. (num)

-   **`total_time`**: The total time taken by the participant to complete a particular trip. This measurement is derived from the collected location data and corresponds to the `distance` covered in the same trip. (num)

-   **`direct_distance`**: The shortest possible distance between the starting and ending point of a trip. This measurement is calculated using the 'as the crow flies' method, which ignores any detours or turns taken during the trip. (num)

```{r}
library(gt)
library(dplyr)

# Create a summarized dataframe
summary_df <- posmo_analysis %>%
  summarise(
    num_trips = n_distinct(trip_id),
    num_users = n_distinct(user_id),
    num_days = n_distinct(day),
    min_day = min(day, na.rm = TRUE),
    max_day = max(day, na.rm = TRUE),
    num_transport_modes = n_distinct(transport_mode),
    avg_distance = mean(distance, na.rm = TRUE),
    max_distance = max(distance, na.rm = TRUE),
    min_distance = min(distance, na.rm = TRUE),
    avg_total_time = mean(total_time, na.rm = TRUE),
    max_total_time = max(total_time, na.rm = TRUE),
    min_total_time = min(total_time, na.rm = TRUE),
    avg_direct_distance = mean(direct_distance, na.rm = TRUE),
    max_direct_distance = max(direct_distance, na.rm = TRUE),
    min_direct_distance = min(direct_distance, na.rm = TRUE)
  )

# Convert to gt table
summary_table <- gt(summary_df) %>%
  tab_header(
    title = "Summary of Posmo Analysis Data"
  ) %>%
  cols_label(
    num_trips = "Number of Trips",
    num_users = "Number of Users",
    num_days = "Number of Days",
    min_day = "Earliest Recorded Day",
    max_day = "Latest Recorded Day",
    num_transport_modes = "Number of Transport Modes",
    avg_distance = "Average Distance (m)",
    max_distance = "Maximum Distance (m)",
    min_distance = "Minimum Distance (m)",
    avg_total_time = "Average Total Time (min)",
    max_total_time = "Maximum Total Time (min)",
    min_total_time = "Minimum Total Time (min)",
    avg_direct_distance = "Average Direct Distance (m)",
    max_direct_distance = "Maximum Direct Distance (m)",
    min_direct_distance = "Minimum Direct Distance (m)"
  ) %>%
  fmt_number(
    columns = vars(avg_distance, max_distance, min_distance, avg_total_time, max_total_time, min_total_time, avg_direct_distance, max_direct_distance, min_direct_distance),
    decimals = 2
  )

# Print the table
print(summary_table)

```

### Selection of relevant trips

## **Methods**

The following methods will be applied in this study:

1.  **Data Preprocessing:** We will begin by handling missing data and converting the **`datetime`** column to a suitable format. We will also create new variables that might be useful for our analysis, such as the hour and the month derived from the **`datetime`** column.

2.  **Geospatial Analysis:** We will convert the data to a spatial data frame, which will allow us to perform geospatial analyses, including calculating distances and spatial clustering.

3.  **Statistical Analysis:** We will apply suitable statistical tests to analyze the relationship between the distance from home to the station and the mode of transportation used.

4.  **Time-series Analysis:** Considering the timestamp data, we will explore it as a time-series to uncover patterns of movement or transportation usage over various periods (daily, weekly, monthly, etc.). This will help us understand and predict changes in the user's transportation habits.

5.  **User Profiling:** We will segment users based on their transportation mode and travel patterns. Creating these profiles could provide insights into different types of users or behaviors, and allow us to tailor interventions or recommendations to specific user groups.

## **Results**

In this section, we will present our findings from the statistical and geospatial analyses. We will provide clear and concise visualizations to illustrate patterns and trends in the data, such as the distribution of different modes of transportation, the distances traveled by different modes of transportation, and the temporal variations in these variables.

## **Discussion**

We will discuss our findings in the context of our research questions. We will interpret the results of our analyses and discuss whether these results align with our expectations or contradict them. We will also discuss potential factors that might explain any unexpected findings.
=======
---
title: Commuting Mode Choice based on distance to the next train station
author: Marijana Maric and Pablo Bischofberger
output: html
bibliography: pted_bib.bib
csl: harvard-educational-review.csl
format:
  html:
    code-fold: true
    toc: true
    toc-depth: 4
    toc-location: left
    toc-expand: true
    
warning: false
message: false
---

<!-- You can add  your R Code with Code chunks-->

```{r}
#| echo: false
#| warning: false
#| message: false

# You can set chunk options individually per code chunk, as was done with this
# code chunk.

# echo: false           hides the code from the generated output
# warning: false        hides warnings from the generated output
# message: false        hides messages from the generated output

# To apply the setting for all code chunks, add the options to the yaml header of the document (in between the ---) without the preceeding "#|".

```

## Abstract

This study examines the relationship between the distance from home to the train station and the transportation mode used. The analysis of trajectory data seeks to identify patterns and factors influencing the choice of transportation. Statistical methods, such as regression models and clustering techniques, are employed. The study is constrained by the small sample size, inaccurate GPS data, and unaccounted for confounding variables.

## Background and Research Goals

In urban areas, understanding the factors that influence individuals' transport mode choices is crucial for developing efficient and sustainable mobility systems [@europeanenvironmentagencyeea2019]. The proximity to a train station has been identified as a significant factor in determining transport mode preferences [@wibowo2010]. Shorter distances to train stations may encourage walking and public transportation use, while longer distances may lead to increased reliance on private vehicles or alternative modes of transport [@tennoy2022].

The research goals of this study are twofold. First, we aim to investigate the impact of distance to the nearest train station on transport mode choices. By analyzing real-world data and employing statistical methods, such as t-tests, regression analysis, and clustering techniques, we seek to uncover patterns and relationships between distance and transport mode preferences.

Second, we aim to examine the role of different distance measurement methods in analyzing the relationship between distance and transport mode choice. We will explore the effectiveness of statistical methods in uncovering insights and evaluate how the choice of distance measurement influences the analysis. Additionally, we will consider how transportation modes should be categorized to effectively analyze their relationship with distance.

To address these objectives and shed light on the relationship between distance to the nearest train station and transport mode choices, the following research questions will guide our investigation:

1. How does the distance to the nearest train station influence individuals' transport mode preferences?
2. Can statistical methods, such as t-tests, regression analysis, and clustering techniques, effectively analyze the relationship between distance and transport mode choice, and provide valuable insights?
3. How does the choice of distance measurement method influence the analysis of the relationship between distance and transport mode?
4. What are the effective ways to categorize transportation modes to analyze their relationship with distance?

## Data Description

The data will consist of GPS trajectory data collected from individuals traveling to nearest train stations. The dataset will include information on the mode of transportation used (e.g., walking, biking, e-bike, car, public transit), as well as the distance between the individual's home and the train station and in what time this is made. Each record in the dataset includes the following variables:

-   **`user_id`**: A unique identifier for each individual in the study. (chr)

-   **`datetime`**: The date and time of each recorded location. (dttm)

-   **`weekday`**: The day of the week. (chr)

-   **`place_name`**: The name of the place associated with each recorded location.(chr)

-   **`transport_mode`**: The mode of transportation used by the individual (e.g., walking, biking, car, public transit).(chr)

-   **`lon_x`** and **`lat_y`**: The longitude and latitude of each recorded location.(dbl)

```{r, warning=FALSE, echo=TRUE, message = FALSE}
# Load required libraries
library(readr)
library(sf)
library(dplyr)
library(ggplot2)
library(lubridate)

# Load the data
data <- read_delim("data/posmo.csv")

```

## Methods

The following methods will be applied in this study:

1.  **Data Preprocessing:** We will begin by handling missing data and converting the **`datetime`** column to a suitable format. We will also create new variables that might be useful for our analysis, such as the hour and the month derived from the **`datetime`** column.

2.  **Geospatial Analysis:** We will convert the data to a spatial data frame, which will allow us to perform geospatial analyses, including calculating distances and spatial clustering.

3.  **Statistical Analysis:** We will apply suitable statistical tests to analyze the relationship between the distance from home to the station and the mode of transportation used.

4.  **Time-series Analysis:** Considering the timestamp data, we will explore it as a time-series to uncover patterns of movement or transportation usage over various periods (daily, weekly, monthly, etc.). This will help us understand and predict changes in the user's transportation habits.

5.  **User Profiling:** We will segment users based on their transportation mode and travel patterns. Creating these profiles could provide insights into different types of users or behaviors, and allow us to tailor interventions or recommendations to specific user groups.

## Results

In this section, we will present our findings from the statistical and geospatial analyses. We will provide clear and concise visualizations to illustrate patterns and trends in the data, such as the distribution of different modes of transportation, the distances traveled by different modes of transportation, and the temporal variations in these variables.

## **Discussion**

The findings of this study contribute to our understanding of how distance to the nearest train station impacts transport mode choices and the effectiveness of statistical methods in analysing this relationship. It is important to acknowledge that the conclusions drawn from this study are based on a small sample size consisting solely of students in this module, which may introduce limitations and potential biases. Nonetheless, the research questions can be addressed as follows:

Examining the influence of distance to the nearest train station on transport mode choice, the analysis revealed a clear correlation between distance and transport mode preferences. Shorter distances to the train station appeared to encourage walking and public transportation use, while longer distances were associated with a higher reliance on private vehicles or alternative modes of transport. These findings align with previous research [@wibowo2010], highlighting the significance of proximity to train stations in shaping transport mode choices.

Regarding the effectiveness of statistical methods in analysing the relationship between distance and transport mode choice, the employed methods, including t-tests, regression analysis, and clustering techniques, proved valuable in uncovering patterns and relationships within the limited sample. These methods allowed for a more profound understanding of the preferences and behaviours of students in this module. However, it is important to recognize the limitations of generalizing these statistical findings due to the small sample size. Future studies with larger and more diverse samples are necessary to validate and generalize these results.

Considering the influence of different distance measurement methods on the analysis of the distance-transport mode relationship, it is worth noting that the choice of measurement can impact the analysis. Different methods, such as straight-line distance, network distance, or travel time, may capture different aspects of accessibility and travel behaviour. Exploring the effects of various distance measurement methods in future research would provide a more comprehensive understanding of their influence on the relationship between distance and transport mode choice.

In summary, this study provides valuable insights into the relationship between distance to the nearest train station and transport mode choices. However, the findings should be interpreted within the limitations of a small and specific sample. Further research with larger and more diverse samples is needed to validate and extend these findings, ensuring a more robust understanding of the factors influencing transport mode choices in urban areas.


>>>>>>> 65cd770ef0c7c5f5773340a0e4ec2fe5b298b8df
